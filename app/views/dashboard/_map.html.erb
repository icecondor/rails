<% content_for :header do %>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.1/leaflet.css" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.1/leaflet.js" type="text/javascript">
  </script>
<% end %>

<script>
  $('.navbar .nav #livemap').addClass('active')
</script>

<!-- initial data -->
<script>
var group = <%=raw @group.to_json %>;
$(function() {
  var center = [0, 0];
  var zoom = 4;

  if(Object.keys(group).length > 0) {
    box = bounding_box(group)
    console.dir(box)
    center = gju.rectangleCentroid(box)
    zoom = pick_zoom(box)
  }

  mapstart(center, zoom)
  iceCondor.on('hello', ic_connected);
  iceCondor.on('disconnect', ic_disconnected);
});
</script>

<div class="mapfloatheading">
  <div class="mapfloatcontent">
    <p id="subtitle">
      IceCondor is simple location sharing for groups.
    </p>

    <%= flash[:notice] %>

    <p id="publicupdates">
      <span id="titlelist"><%= msgtitle %></span>
    <table id="trackedlist">
      <thead>
      <tr><td></td><td>Username</td><td>Reported at</td></tr>
      </thead>
      <tbody></tbody>
    </table>
    </p>
  </div>
</div>


<!-- Google Maps -->
<div id="map" style="width: 100%; height: 500px; margin-left:auto; margin-right: auto"></div>

<script id="trackedUserTemplate" type="text/x-jquery-tmpl">
  <tr id='{{=UserName}}-profile'>
    <td><img class="marker profilelink" src="{{=ImageUrl}}" /></td>
    <td><a class="profilelink" href="/{{=UserName}}">{{=UserName}}</a></td>
    <td id='{{=UserName}}-date'>{{=TimeAgo}} </td>
  </tr>
</script>