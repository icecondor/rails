<% content_for :header do %>
  <script src="//maps.google.com/maps/api/js?sensor=false&v=3&libraries=geometry" type="text/javascript"></script>
<% end %>

<script>
  $('.navbar .nav #livemap').addClass('active')
</script>

<!-- initial data -->
<script>
var group = <%=raw @group.to_json %>;
$(function() {
  mapstart();
  define_group_ui();
  play_initial_locations();
  iceCondor.on('hello', ic_connected);
  iceCondor.on('disconnect', ic_disconnected);
});
</script>

<div class="mapfloatheading">
  <div class="mapfloatcontent">
    <p id="subtitle">
      IceCondor is simple location tracking for groups.
    </p>

    <%= flash[:notice] %>

    <p id="publicupdates">
      <span id="titlelist"><%= msgtitle %></span>
    <table id="trackedlist">
      <thead>
      <tr><td></td><td>Username</td><td>Reported at</td></tr>
      </thead>
      <tbody></tbody>
    </table>
    </p>
  </div>
</div>


<!-- Google Maps -->
<div id="map_canvas" style="width: 100%; height: 500px; margin-left:auto; margin-right: auto"></div>

<script id="trackedUserTemplate" type="text/x-jquery-tmpl">
  <tr id='{{=UserName}}-profile'>
    <td><img class="marker profilelink" src="{{=ImageUrl}}" /></td>
    <td><a class="profilelink" href="/{{=UserName}}">{{=UserName}}</a></td>
    <td id='{{=UserName}}-date'>{{=TimeAgo}} </td>
  </tr>
</script>